<Window x:Class="Calc.ConnectorRevit.Views.MainView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Calc.ConnectorRevit.Views" 
        d:DataContext="{d:DesignInstance Type=local:ViewModel}"
        Loaded="Window_Loaded"
        mc:Ignorable="d" 
        Background="White"
        Height="600" MinHeight="600"
        Width="600" MinWidth="600"
        WindowStartupLocation="CenterScreen"
        Topmost="True">

    <Window.Resources>
        <local:ItemTemplateSelector x:Key="ItemTemplateSelector"/>

        <Style x:Key="TreeTextStyle" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="0,0,2,0"/>
        </Style>

        <Style x:Key="ButtonStyle" TargetType="Button">
            <Setter Property="Margin" Value="10,0,0,0"/>
            <Setter Property="Height" Value="25"/>
            <Setter Property="Width" Value="50"/>
            <Setter Property="DockPanel.Dock" Value="Right"/>
        </Style>

        <DataTemplate x:Key="BranchItemTemplate">
            <TextBlock>
                <TextBlock.Text>
                    <MultiBinding StringFormat="{}{0}: {1} ({2})">
                        <Binding Path="Parameter" />
                        <Binding Path="Value" />
                        <Binding Path="Elements.Count" />
                    </MultiBinding>
                </TextBlock.Text>
            </TextBlock>
        </DataTemplate>

        <DataTemplate x:Key="TreeItemTemplate">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="{Binding Name}"
                       Style="{StaticResource TreeTextStyle}" />
                <TextBlock>
                    <TextBlock.Text>
                        <MultiBinding StringFormat="{}({0})">
                            <Binding Path="Elements.Count" />
                        </MultiBinding>
                    </TextBlock.Text>
                </TextBlock>
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="BuildupTemplate">
            <DockPanel LastChildFill="True">
                <Label Content="Assign Buildup:" DockPanel.Dock="Top"/>
                <ComboBox SelectedItem="{Binding Buildup}" 
                          ItemsSource="{Binding DataContext.AllBuildups, 
                                                RelativeSource={RelativeSource AncestorType={x:Type Window}}}" 
                          DisplayMemberPath="Name"
                          DockPanel.Dock="Top"/>
                <Label Content="Preview:" DockPanel.Dock="Top"/>
                <DataGrid ItemsSource="{Binding Buildup.Components}"
                          AutoGenerateColumns="False"
                          VerticalAlignment="Top"
                          MinHeight="100">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Material" Binding="{Binding Material.Name}" />
                        <DataGridTextColumn Header="Amount" Binding="{Binding Amount}" IsReadOnly="True" />
                    </DataGrid.Columns>
                </DataGrid>
            </DockPanel>
        </DataTemplate>
    </Window.Resources>
    <Grid>
    
    
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="20*"/>
            <ColumnDefinition Width="20"/>
            <ColumnDefinition Width="20*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="50"/>
            <RowDefinition Height="0"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

            <DockPanel Grid.Column="0"
                       Grid.Row="0"
                       Margin="10"
                       HorizontalAlignment="Stretch">
                <Button Content="Load" Style= "{StaticResource ButtonStyle}"/>
                <ComboBox ItemsSource="{Binding DataContext.AllForests, RelativeSource={RelativeSource AncestorType={x:Type Window}}}"
                          DisplayMemberPath="Name"
                          DockPanel.Dock="Left"
                          Height="25"
                          HorizontalAlignment="Stretch"/>
            </DockPanel>

            <DockPanel Grid.Column="2"
                       Grid.Row="0"
                       Margin="10"
                       HorizontalAlignment="Stretch">
                <Button Content="Save" Style= "{StaticResource ButtonStyle}"/>
                <Button Content="Load" Style= "{StaticResource ButtonStyle}"/>
                <ComboBox ItemsSource="{Binding DataContext.AllMappings, RelativeSource={RelativeSource AncestorType={x:Type Window}}}"
                          DisplayMemberPath="Name"
                          DockPanel.Dock="Left"
                          Height="25"
                          HorizontalAlignment="Stretch"/>
            </DockPanel>


            <Grid Grid.Column="0"
                  Grid.Row="2"
                  Margin="10">
            <TreeView x:Name="treeView"
                      ItemsSource="{Binding Items}"
                      SelectedItemChanged="TreeViewSelectedItemChanged"
                      MouseLeftButtonDown="MouseLeftButtonDown">
                <TreeView.ItemTemplate>
                    <HierarchicalDataTemplate ItemsSource="{Binding SubBranches}">
                        <ContentControl Content="{Binding}"
                                        ContentTemplateSelector="{StaticResource ItemTemplateSelector}"/>
                    </HierarchicalDataTemplate>
                </TreeView.ItemTemplate>
            </TreeView>
        </Grid>

        <DockPanel Grid.Column="2"
                    Grid.Row="2"
                    Margin="10">
            <Button Content="Calculate"
                    DockPanel.Dock="Bottom"
                    Height="30"
                    Click="CalculateClicked"/>
            <ContentControl Content ="{Binding SelectedBranch}"
                            DockPanel.Dock="Top"
                            ContentTemplate="{StaticResource BuildupTemplate}"
                            BorderThickness="1"/>
        </DockPanel>

    </Grid>


    <Grid x:Name="LoadingOverlay"
            Background="LightGray"
          Margin="10">
        <TextBlock HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Text="LOADING..."/>
    </Grid>
    
    
</Grid>
</Window>